(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[24],{"997d":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-pa-md row justify-center",staticStyle:{"font-size":"18px"}},[a("q-card",{staticStyle:{width:"65%",height:"51rem"},attrs:{flat:"",bordered:""}},[a("q-card-section",{attrs:{horizontal:""}},[a("q-card-section",{staticClass:"col-3"},[a("q-item",{staticClass:"text-h4"},[t._v("私信")]),a("q-item",[a("q-input",{attrs:{outlined:"",placeholder:"查找你想私信的用户"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"},on:{click:function(e){return e.stopPropagation(),t.find_contact_person(e)}}})]},proxy:!0}]),model:{value:t.person,callback:function(e){t.person=e},expression:"person"}})],1),a("q-separator",{attrs:{spaced:"",inset:""}}),a("q-item",[t._v("联系人列表")]),a("q-layout",{staticStyle:{"max-height":"39rem"},attrs:{container:""}},[a("q-page-container",[a("q-list",t._l(t.contact,(function(e,n){return a("div",{key:n},[a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.get_msg_with_person(e)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{rounded:""}},[a("img",{attrs:{src:e.avatar}}),e.unread_count?a("q-badge",{attrs:{color:"red","text-color":"white",floating:""}},[t._v(" "+t._s(e.unread_count)+" ")]):t._e()],1)],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.person))])],1),a("q-item-section",{attrs:{side:""}},[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"delete",color:"deep-orange"},on:{click:function(e){return e.stopPropagation(),t.del_one_contact(n)}}},[a("q-tooltip",[t._v("从列表中删除")])],1)],1)],1),a("q-separator",{attrs:{spaced:"",inset:""}})],1)})),0),a("div",{staticClass:"q-mt-lg"}),a("q-page-scroller",[a("q-btn",{attrs:{fab:"",icon:"keyboard_arrow_up",color:"accent"}})],1)],1)],1)],1),a("q-card-section",{staticClass:"col-9"},[t.chat_with?a("div",[a("div",{staticClass:"text-h4 text-center"},[a("q-avatar",{attrs:{rounded:""}},[a("img",{attrs:{src:t.chat_with.avatar}})]),t._v("\n              "+t._s(t.chat_with.person)+"\n            ")],1),a("q-separator",{staticClass:"q-mt-sm",attrs:{inset:""}}),a("q-scroll-area",{ref:"msgArea",staticClass:"q-pa-md",staticStyle:{height:"33rem"},attrs:{"thumb-style":t.thumbStyle,"bar-style":t.barStyle}},[t.msg_is_end?a("div",{staticClass:"text-center"},[t._v("\n                所有聊天记录\n            ")]):a("div",{staticClass:"text-center"},[a("q-btn",{attrs:{label:"查看更多聊天记录",outline:""},on:{click:t.get_messages}})],1),t._l(t.messages,(function(e,n){return a("div",{key:n},[t.is_new_block(n)?a("div",{staticClass:"text-center"},[a("br"),a("i-time",{attrs:{time:new Date(e.stamp)}})],1):t._e(),a("q-chat-message",{attrs:{name:e.name,avatar:e.avatar,text:e.text,stamp:e.stamp,sent:e.sent}})],1)}))],2),a("q-separator",{attrs:{inset:""}}),a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-editor",{attrs:{flat:"","content-class":"bg-amber-1","toolbar-text-color":"white","toolbar-bg":"info","min-height":"5rem","max-height":"5rem",toolbar:[["bold","italic","underline"],[{label:t.$q.lang.editor.formatting,icon:t.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h3","h4","h5","h6","code"]}]]},model:{value:t.editor,callback:function(e){t.editor=e},expression:"editor"}})],1),a("Button",{staticClass:"float-right q-mr-md",attrs:{type:"primary",loading:t.loading},on:{click:t.send}},[t._v("发送")])],1):a("div",[a("q-card-actions",{staticClass:"row justify-center q-mt-lg"},[a("q-img",{staticStyle:{width:"300px",height:"400px"},attrs:{src:"https://www.helloimg.com/images/2020/07/27/no_message3decd4a9c615764a.jpg"}})],1),a("q-card-actions",{staticClass:"row justify-center"},[a("div",{staticClass:"text-h4"},[t._v(" 暂时没有私信 ")])])],1)])],1)],1)],1)},s=[];a("ac6a"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("7f7f"),a("6b54"),a("06db");function r(t,e){var a;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=o(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,c=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return i=t.done,t},e:function(t){c=!0,r=t},f:function(){try{i||null==a.return||a.return()}finally{if(c)throw r}}}}function o(t,e){if(t){if("string"===typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var c={name:"message",data:function(){return{contact:[],messages:[],loaded:!1,editor:"",person:"",chat_with:null,step_len:10,msg_is_end:!1,my_avatar:"",minuteDur:6e4,hourDur:36e5,dayDur:864e5,weekDur:6048e5,loading:!1}},methods:{message_handle:function(t){var e={};return e={name:t.from,stamp:t.created_at,text:[t.content]},t.from!=this.chat_with.person?(e.sent=!0,e.avatar=this.my_avatar):e.avatar=this.chat_with.avatar,e},change_to_bottom:function(){this.$refs.msgArea.setScrollPosition(5e3,300)},get_messages:function(){var t=this,e={person:this.chat_with.person,l:this.messages.length+1,r:this.messages.length+this.step_len};this.chat_with.unread_count>0&&(e.unread="exist"),this.$req.get("getMessages",e).then((function(e){if(void 0==e.errno){e.messages.length<t.step_len&&(t.msg_is_end=!0);var a,n=r(e.messages);try{for(n.s();!(a=n.n()).done;){var s=a.value;t.messages.unshift(t.message_handle(s))}}catch(o){n.e(o)}finally{n.f()}t.chat_with.unread_count=0,t.messages.length<=t.step_len&&setTimeout((function(){t.change_to_bottom()}),500)}}))},get_msg_with_person:function(t){this.chat_with=t,this.messages.splice(0),this.msg_is_end=!1,this.get_messages()},find_contact_person:function(){var t=this;if(this.person=this.person.trim(),""!=this.person)if(this.person!=this.$store.state.user.username){for(var e=0;e<this.contact.length;e++)if(this.contact[e].person==this.person)return void this.get_msg_with_person(this.contact[e]);this.$req.get("findContactPerson",{person:this.person}).then((function(e){void 0==e.errno&&(e=e.chat,t.contact.unshift(e),t.get_msg_with_person(e))}))}else this.$notify("error","不要给自己发私信");else this.$notify("error","请输入查询用户")},send:function(){var t=this;if(""!=this.editor.trim()){this.loading=!0;var e=new FormData;e.append("person",this.chat_with.person),e.append("content",this.editor),this.$req.post("sendOneMessage",e).then((function(e){void 0==e.errno&&(t.messages.push(t.message_handle(e.message)),t.editor="",setTimeout(t.change_to_bottom(),100)),t.loading=!1}))}else this.$notify("error","不能发空消息")},del_one_contact:function(t){var e=this;this.$req.get("delOneContact",{person:this.contact[t].person}).then((function(a){void 0==a.errno&&(e.chat_with&&e.chat_with.person==e.contact[t].person&&(e.chat_with=null),e.contact.splice(t,1))}))}},computed:{thumbStyle:function(){return{right:"4px",borderRadius:"5px",backgroundColor:"#027be3",width:"5px",opacity:.75}},barStyle:function(){return{right:"2px",borderRadius:"9px",backgroundColor:"#027be3",width:"9px",opacity:.2}},is_new_block:function(){return function(t){if(0==t)return!0;var e=new Date(this.messages[t-1].stamp).getTime(),a=new Date(this.messages[t].stamp).getTime(),n=(new Date).getTime(),s=n-a,r=n-e;return!(s>=this.weekDur)&&(s>=this.dayDur?parseInt(r/this.dayDur)>parseInt(s/this.dayDur):s>=this.hourDur?parseInt(r/this.hourDur)>parseInt(s/this.hourDur):r-s>=5*this.minuteDur)}}},mounted:function(){var t=this;setTimeout((function(){t.$store.state.user.is_login?(t.my_avatar=t.$store.state.user.avatar,t.$req.get("getContacts").then((function(e){if(void 0==e.errno){var a,n=r(e.contacts);try{for(n.s();!(a=n.n()).done;){var s=a.value;t.contact.push(s)}}catch(o){n.e(o)}finally{n.f()}}}))):t.$router.push({name:"home"})}),500)}},l=c,h=a("2877"),u=a("f09f"),d=a("a370"),m=a("66e5"),p=a("27f9"),g=a("0016"),f=a("eb85"),_=a("4d5a"),v=a("09e3"),b=a("1c1c"),y=a("4074"),w=a("cb32"),q=a("58a8"),x=a("0170"),C=a("9c40"),S=a("05c0"),Q=a("5096"),k=a("4983"),D=a("8169"),$=a("d66b"),I=a("4b7e"),A=a("068f"),j=a("eebe"),T=a.n(j),P=Object(h["a"])(l,n,s,!1,null,"428c6b3c",null);e["default"]=P.exports;T()(P,"components",{QCard:u["a"],QCardSection:d["a"],QItem:m["a"],QInput:p["a"],QIcon:g["a"],QSeparator:f["a"],QLayout:_["a"],QPageContainer:v["a"],QList:b["a"],QItemSection:y["a"],QAvatar:w["a"],QBadge:q["a"],QItemLabel:x["a"],QBtn:C["a"],QTooltip:S["a"],QPageScroller:Q["a"],QScrollArea:k["a"],QChatMessage:D["a"],QEditor:$["a"],QCardActions:I["a"],QImg:A["a"]})}}]);